{
  "entities": {
    "HeritageSite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HeritageSite",
      "type": "object",
      "description": "Represents a heritage site with associated details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the heritage site."
        },
        "title": {
          "type": "string",
          "description": "Title of the heritage site."
        },
        "shortDescription": {
          "type": "string",
          "description": "A brief description of the heritage site."
        },
        "longDescription": {
          "type": "string",
          "description": "A detailed description of the heritage site."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the thumbnail image for the heritage site."
        },
        "coverImageUrl": {
          "type": "string",
          "description": "URL of the cover image for the heritage site."
        },
        "lowPolyModelUrl": {
          "type": "string",
          "description": "URL of the low-poly 3D model for the heritage site."
        },
        "highPolyModelUrl": {
          "type": "string",
          "description": "URL of the high-poly 3D model for the heritage site."
        },
        "fallback360Url": {
          "type": "string",
          "description": "URL of the 360° panorama image for the heritage site."
        },
        "audioNarrationUrl": {
          "type": "string",
          "description": "URL of the audio narration for the heritage site."
        }
      },
      "required": [
        "id",
        "title",
        "shortDescription",
        "thumbnailUrl"
      ]
    },
    "Artifact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Artifact",
      "type": "object",
      "description": "Represents an artifact associated with a heritage site.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the artifact."
        },
        "siteId": {
          "type": "string",
          "description": "Reference to HeritageSite. (Relationship: HeritageSite 1:N Artifact)"
        },
        "title": {
          "type": "string",
          "description": "Title of the artifact."
        },
        "description": {
          "type": "string",
          "description": "Description of the artifact."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image for the artifact."
        },
        "modelFileUrl": {
          "type": "string",
          "description": "URL of the 3D model file for the artifact."
        },
        "fallbackImageUrl": {
          "type": "string",
          "description": "URL of the fallback image for the artifact (e.g., 360° panorama)."
        },
        "audioNarrationUrl": {
          "type": "string",
          "description": "URL of the audio narration for the artifact."
        }
      },
      "required": [
        "id",
        "siteId",
        "title",
        "imageUrl"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "preferences": {
          "type": "string",
          "description": "Reference to UserPreference. (Relationship: User 1:1 UserPreference)"
        },
        "favoriteSiteIds": {
          "type": "array",
          "description": "References to HeritageSite. (Relationship: User 1:N HeritageSite (favorites))",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id"
      ]
    },
    "UserPreference": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserPreference",
      "type": "object",
      "description": "Represents user-specific preferences for the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user preference."
        },
        "accessibilityOn": {
          "type": "boolean",
          "description": "Indicates whether accessibility mode is enabled."
        },
        "audioOn": {
          "type": "boolean",
          "description": "Indicates whether audio narration is enabled."
        },
        "fontScale": {
          "type": "number",
          "description": "Scaling factor for the font size."
        },
        "highContrast": {
          "type": "boolean",
          "description": "Indicates whether high contrast mode is enabled."
        },
        "lowBandwidth": {
          "type": "boolean",
          "description": "Indicates whether low bandwidth mode is enabled."
        },
        "language": {
          "type": "string",
          "description": "Preferred language for the application."
        }
      },
      "required": [
        "id"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "userName": {
          "type": "string",
          "description": "Admin's username."
        }
      },
      "required": [
        "id",
        "userName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/heritage_sites/{heritageSiteId}",
        "definition": {
          "entityName": "HeritageSite",
          "schema": {
            "$ref": "#/backend/entities/HeritageSite"
          },
          "description": "Stores details about heritage sites. Publicly readable.",
          "params": [
            {
              "name": "heritageSiteId",
              "description": "Unique identifier for the heritage site."
            }
          ]
        }
      },
      {
        "path": "/heritage_sites/{heritageSiteId}/artifacts/{artifactId}",
        "definition": {
          "entityName": "Artifact",
          "schema": {
            "$ref": "#/backend/entities/Artifact"
          },
          "description": "Stores artifacts related to heritage sites. Includes denormalized 'siteId' for querying.",
          "params": [
            {
              "name": "heritageSiteId",
              "description": "Unique identifier for the parent heritage site."
            },
            {
              "name": "artifactId",
              "description": "Unique identifier for the artifact."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access restricted to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (same as auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/preferences",
        "definition": {
          "entityName": "UserPreference",
          "schema": {
            "$ref": "#/backend/entities/UserPreference"
          },
          "description": "Stores user-specific preferences. Access restricted to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (same as auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Marks a user as an admin. Existence of a document grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the admin user (same as auth.uid)."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for security, scalability, and ease of querying, following the principles of Authorization Independence, Structural Segregation, and Access Modeling. User data and preferences are stored under `/users/{userId}`. Heritage sites and their artifacts are stored separately to maintain a flat security structure and avoid complex authorization rules. Admin roles are managed via a separate `/roles_admin/{uid}` collection for simple role verification.\n\n**Authorization Independence:**\n*   The structure avoids hierarchical authorization dependencies. For example, artifact access does NOT depend on fetching heritage site data. Security rules can be written without using `get()` calls.\n*   Specifically, artifacts include `siteId` to enable direct queries and avoid needing to traverse the parent site to access artifact data.\n\n**Structural Segregation:**\n*   Heritage sites and artifacts are stored in separate collections, allowing different security rules if needed in the future. Currently, all sites are assumed to be publicly accessible, while access to user-specific data is restricted to the authenticated user.\n\n**Access Modeling:**\n*   User preferences are stored under `/users/{userId}/preferences` to ensure that only the authenticated user can access and modify their own preferences.\n*   Admin roles are managed using the 'Existence over Content' principle, where the mere existence of a document in `/roles_admin/{uid}` grants admin privileges.\n\n**QAPs (Rules are not Filters):**\n*   The separation of collections ensures that listing heritage sites or artifacts does not require filtering based on user roles or permissions. All heritage sites are considered publicly listable. User-specific data is secured via path-based ownership.\n\n**Invariants:**\n*   Timestamps could be added to each document (e.g., `createdAt`, `updatedAt`) and enforced via security rules to maintain data integrity. Ownership is enforced via the path structure for user-specific data (`/users/{userId}`)."
  }
}